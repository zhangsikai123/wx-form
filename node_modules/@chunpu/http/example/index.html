<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Promised Based Http Client for Real Project</title>
  <script src="//lib.baomitu.com/jquery/1.12.4/jquery.min.js"></script>
  <script src="//lib.baomitu.com/axios/0.18.0/axios.min.js"></script>
  <script src="../dist/http.js"></script>
</head>
<body>
<script>
// 可加上各平台模拟测试
$(() => {
  var formData = new FormData()
  formData.append('key', 'value')

  fetch('/json', {
    method: 'POST',
    body: formData
  }).then(response => {
    return response.json()
  }).then(x => {
    console.log(x, 99999999)
  }).catch(err => {
    console.log(err, 99999999)
  })

  $.ajax('/json', {data: {}, timeout: 1}).then((...args) => {
    console.log('jquery success', ...args)
  }, (...args) => {
    console.log('jquery error', ...args, args)
  })

  axios.defaults.timeout = 0.001 * 1000
  axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded'

  axios.interceptors.request.use(config => {
    console.log('config', config)
    return config
  })

  axios.interceptors.response.use(response => {
    console.log('response', response)
    return response
  }, err => {
    console.log('axios err', err)
  })

  axios.post('/json', 0, {
    // timeout: 1,
    headers: {'content-type': 'application/x-www-form-urlencoded', 'a-b': 'b'},
    responseType: 'text'
  }).then((...args) => {
    console.log('axios success', ...args)
  }).catch(err => {
    console.log('axios error', err.message)
    console.dir(err)
  })

  fetch('/badjson', {
    body: JSON.stringify({
      fetch: true
    }),
    headers: {
      'content-type': 'application/json'
    },
    method: 'POST'
  }).then((...args) => {
    console.log('fetch success', ...args)
    var response = args[0]
    var headers = [...response.headers]
    console.log('headers', headers)
    return response.text()
  }).then(data => {
    console.log(7777, data)
  }).catch((...args) => {
    console.log('fetch error', ...args)
  })

  http.defaults.timeout = 0.001 * 1000

  http.interceptors.response.use(response => {
    console.log('http response', response)
    return response
  }, err => {
    console.log('http err', err)
  })

  http.init({
    // jQuery: jQuery
  })
  http.post('/json', formData, {
    params: {
      query: 'string'
    }
  }).then(response => {
    console.log('raw response', response)
  })

  // axios.post('/body', {
  //   key: 'value',
  //   axios: true,
  // }, {
  //   responseType: 'text'
  // }).then((...args) => {
  //   console.log(2222, args)
  // })

  // test
  // var xhr = new XMLHttpRequest()
  // xhr.open('POST', '/json', false)
  // xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
  // xhr.send(formData)
})
</script>
</body>
</html>
